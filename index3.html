<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>æ”¾å­¸æ¥é€æ‰“æ‰“æ°£</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
   html, body {
     margin: 0;
     padding: 0;
     background: #000;
     color: white;
     height: 100%;
     overflow: hidden;
   }
   #reader {
     width: 100vw;
     height: 100vh;
   }
</style>
</head>
<body>
   
<div id="reader"></div>
   <h3 font-color='white'>æ”¾å­¸æ¥é€æ‰“æ‰“æ°£</h3>
<script>
   let html5QrCode;
   let isRunning = false;
   // æª¢æ¸¬æ˜¯å¦ç‚º iPad
   function isIpad() {
     const ua = navigator.userAgent.toLowerCase();
     return /ipad/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
   }
   // æª¢æ¸¬æ˜¯å¦ç‚ºæ‰‹æ©Ÿ
   function isMobile() {
     return /iphone|android|mobile/i.test(navigator.userAgent);
   }
   // æ±ºå®šä½¿ç”¨å‰æˆ–å¾Œé¡é ­
   function getCameraFacingMode() {
     if (isIpad()) return "user";          // iPad ç”¨å‰é¡
     if (isMobile()) return "environment"; // æ‰‹æ©Ÿç”¨å¾Œé¡
     return "user";                        // å…¶ä»–æƒ…æ³é è¨­å‰é¡
   }
   function getFullScreenBoxSize() {
     const minDim = Math.min(window.innerWidth, window.innerHeight);
     return Math.floor(minDim * 0.95);
   }
   function startScanner() {
     const facingMode = getCameraFacingMode();
     const qrboxSize = getFullScreenBoxSize();
     if (isRunning) {
       html5QrCode.stop().then(() => {
         startHtml5QrCode(facingMode, qrboxSize);
       });
     } else {
       startHtml5QrCode(facingMode, qrboxSize);
     }
   }
   function startHtml5QrCode(facingMode, qrboxSize) {
     html5QrCode = new Html5Qrcode("reader");
     html5QrCode.start(
       { facingMode: facingMode },
       {
         fps: 10,
         qrbox: {
           width: qrboxSize,
           height: qrboxSize
         }
       },
       onScanSuccess,
       onScanError
     ).then(() => {
       isRunning = true;
     }).catch(err => console.error("å•Ÿå‹•å¤±æ•—:", err));
   }
   function onScanSuccess(qrCodeMessage) {
     const encodedData = encodeURIComponent(qrCodeMessage.trim());
     html5QrCode.stop().then(() => {
       // ğŸ‘‰ æƒå®Œå¾Œè‡ªå‹•è½‰é ï¼Œæ²’æœ‰ç•™åº•ä»»ä½•è³‡æ–™ï¼ˆå¦‚ä½ è¦"delete"ï¼‰
       window.location.href = `result.html?data=${encodedData}`;
     });
   }
   function onScanError(errorMessage) {
     // å¯ä»¥å¿½ç•¥éŒ¯èª¤
   }
   startScanner();
   window.addEventListener("resize", () => {
     clearTimeout(window.resizeTimeout);
     window.resizeTimeout = setTimeout(() => {
       startScanner();
     }, 300);
   });
</script>
</body>
</html>
